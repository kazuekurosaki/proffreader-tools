<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NovelProof - Proofreader untuk Novel</title>
    <style>
        :root {
            --primary: #4a6fa5;
            --secondary: #166088;
            --accent: #4cb5ae;
            --light: #f8f9fa;
            --dark: #343a40;
            --success: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7f9;
            color: var(--dark);
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 1rem 2rem;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            font-size: 2.2rem;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .logo {
            font-size: 1.8rem;
        }
        
        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
        
        .editor-section, .results-section {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        
        .section-title {
            font-size: 1.4rem;
            margin-bottom: 15px;
            color: var(--secondary);
            border-bottom: 2px solid var(--accent);
            padding-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        textarea {
            width: 100%;
            min-height: 400px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 1rem;
            line-height: 1.6;
            resize: vertical;
            transition: border-color 0.3s;
        }
        
        textarea:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(76, 181, 174, 0.2);
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            margin: 15px 0;
            flex-wrap: wrap;
        }
        
        button {
            padding: 10px 15px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .btn-primary {
            background-color: var(--primary);
            color: white;
        }
        
        .btn-primary:hover {
            background-color: var(--secondary);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .btn-secondary {
            background-color: var(--light);
            color: var(--dark);
            border: 1px solid #ddd;
        }
        
        .btn-secondary:hover {
            background-color: #e9ecef;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .btn-success {
            background-color: var(--success);
            color: white;
        }
        
        .btn-success:hover {
            opacity: 0.9;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .btn-danger {
            background-color: var(--danger);
            color: white;
        }
        
        .btn-danger:hover {
            opacity: 0.9;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .stat-box {
            background: var(--light);
            padding: 15px;
            border-radius: 6px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s;
        }
        
        .stat-box:hover {
            transform: translateY(-5px);
        }
        
        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--primary);
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: #6c757d;
        }
        
        .results-container {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #eee;
            border-radius: 6px;
            padding: 15px;
        }
        
        .issue-item {
            padding: 10px;
            border-left: 4px solid var(--warning);
            margin-bottom: 10px;
            background-color: #fff9e6;
            border-radius: 0 4px 4px 0;
            transition: transform 0.2s;
        }
        
        .issue-item:hover {
            transform: translateX(5px);
        }
        
        .issue-error {
            border-left-color: var(--danger);
            background-color: #ffe6e6;
        }
        
        .issue-success {
            border-left-color: var(--success);
            background-color: #e6ffe6;
        }
        
        .issue-info {
            border-left-color: var(--primary);
            background-color: #e6f0ff;
        }
        
        .issue-type {
            font-weight: bold;
            color: var(--dark);
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .issue-context {
            color: #6c757d;
            font-size: 0.9rem;
            margin-top: 5px;
        }
        
        .highlight {
            background-color: yellow;
            font-weight: bold;
            padding: 0 2px;
        }
        
        .suggestion {
            color: var(--success);
            font-weight: bold;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .api-status {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 10px;
            font-size: 0.9rem;
        }
        
        .status-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            display: inline-block;
        }
        
        .status-connected {
            background-color: var(--success);
        }
        
        .status-disconnected {
            background-color: var(--danger);
        }
        
        footer {
            text-align: center;
            margin-top: 30px;
            padding: 20px;
            color: #6c757d;
            font-size: 0.9rem;
        }
        
        .feature-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .feature-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        
        .feature-title {
            font-weight: bold;
            color: var(--secondary);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><span class="logo">üìñ</span> NovelProof</h1>
            <p class="subtitle">Alat proofreading canggih untuk penulis novel dengan integrasi API</p>
        </header>
        
        <div class="feature-list">
            <div class="feature-item">
                <div class="feature-title"><span>üîç</span> Pemeriksaan Tata Bahasa</div>
                <p>Menggunakan API LanguageTool untuk pemeriksaan tata bahasa dan ejaan yang akurat</p>
            </div>
            <div class="feature-item">
                <div class="feature-title"><span>üë•</span> Konsistensi Karakter</div>
                <p>Memeriksa konsistensi nama karakter dan tempat dalam cerita</p>
            </div>
            <div class="feature-item">
                <div class="feature-title"><span>üí¨</span> Format Dialog</div>
                <p>Memastikan format dialog sesuai dengan kaidah penulisan novel</p>
            </div>
            <div class="feature-item">
                <div class="feature-title"><span>üìä</span> Analisis Statistika</div>
                <p>Menghitung statistik penting seperti jumlah kata, waktu baca, dan lainnya</p>
            </div>
        </div>
        
        <div class="main-content">
            <div class="editor-section">
                <h2 class="section-title"><span>‚úèÔ∏è</span> Editor Naskah</h2>
                <textarea id="novel-text" placeholder="Tempel atau ketik naskah novel Anda di sini...">Contoh naskah novel:

Kapitel 1: Pertemuan

Dia berjalan pelan disepanjang koridor yang gelap. Angin berbisik pelan, membawa suara-suara yang tak jelas. Rania merasa ada yang mengawasinya, tapi ketika berbalik, tak ada siapapun disana.

"Apakah aku hanya membayangkan?" katanya dalam hati.

Tiba-tiba, pintu disebelahnya terbuka dengan suara berderit. Seorang pria tinggi muncul dengan pakaian serba hitam.

"Kau seharusnya tidak berada disini," katanya dengan suara rendah.

Rania merasa jantungnya berdebar kencang. Dia mencoba berkata sesuatu, tapi kata-katanya tersangkut di tenggorokan.</textarea>
                
                <div class="button-group">
                    <button id="check-btn" class="btn-primary"><span>üîç</span> Periksa Naskah</button>
                    <button id="clear-btn" class="btn-secondary"><span>üóëÔ∏è</span> Bersihkan</button>
                    <button id="sample-btn" class="btn-secondary"><span>üìÑ</span> Contoh Naskah</button>
                    <button id="fix-all-btn" class="btn-success" disabled><span>üîß</span> Perbaiki Otomatis</button>
                </div>
                
                <div class="stats-container">
                    <div class="stat-box">
                        <div class="stat-value" id="word-count">0</div>
                        <div class="stat-label">Kata</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="char-count">0</div>
                        <div class="stat-label">Karakter</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="issue-count">0</div>
                        <div class="stat-label">Masalah</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="read-time">0</div>
                        <div class="stat-label">Menit Baca</div>
                    </div>
                </div>
                
                <div class="api-status">
                    <span class="status-indicator status-connected" id="api-status-indicator"></span>
                    <span id="api-status-text">Terhubung dengan API LanguageTool</span>
                </div>
            </div>
            
            <div class="results-section">
                <h2 class="section-title"><span>üìù</span> Hasil Proofreading</h2>
                <div class="results-container" id="results">
                    <div class="issue-item issue-success">
                        <div class="issue-type"><span>‚úÖ</span> Siap untuk memeriksa</div>
                        <div class="issue-context">Klik "Periksa Naskah" untuk memulai analisis</div>
                    </div>
                </div>
                
                <div class="button-group">
                    <button id="save-btn" class="btn-success" disabled><span>üíæ</span> Simpan Hasil</button>
                    <button id="export-btn" class="btn-secondary" disabled><span>üì§</span> Ekspor ke PDF</button>
                </div>
            </div>
        </div>
        
        <footer>
            <p>NovelProof - Alat Proofreading Canggih untuk Novel ¬© 2023 | Menggunakan API LanguageTool</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const novelText = document.getElementById('novel-text');
            const checkBtn = document.getElementById('check-btn');
            const clearBtn = document.getElementById('clear-btn');
            const sampleBtn = document.getElementById('sample-btn');
            const fixAllBtn = document.getElementById('fix-all-btn');
            const saveBtn = document.getElementById('save-btn');
            const exportBtn = document.getElementById('export-btn');
            const resultsContainer = document.getElementById('results');
            const wordCountEl = document.getElementById('word-count');
            const charCountEl = document.getElementById('char-count');
            const issueCountEl = document.getElementById('issue-count');
            const readTimeEl = document.getElementById('read-time');
            const apiStatusIndicator = document.getElementById('api-status-indicator');
            const apiStatusText = document.getElementById('api-status-text');
            
            let issues = [];
            let originalText = '';
            
            // Hitung statistik dasar
            function updateBasicStats() {
                const text = novelText.value;
                const words = text.trim() ? text.trim().split(/\s+/).length : 0;
                const characters = text.length;
                const readTime = Math.ceil(words / 200); // Asumsi 200 kata per menit
                
                wordCountEl.textContent = words.toLocaleString();
                charCountEl.textContent = characters.toLocaleString();
                readTimeEl.textContent = readTime;
            }
            
            novelText.addEventListener('input', updateBasicStats);
            updateBasicStats();
            
            // Fungsi untuk memeriksa tata bahasa menggunakan API LanguageTool
            async function checkGrammarWithAPI(text) {
                try {
                    // Menggunakan API LanguageTool untuk pemeriksaan tata bahasa
                    const response = await fetch('https://api.languagetool.org/v2/check', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded',
                        },
                        body: new URLSearchParams({
                            text: text,
                            language: 'id',
                            enabledOnly: 'false'
                        })
                    });
                    
                    if (!response.ok) {
                        throw new Error('API request failed');
                    }
                    
                    const data = await response.json();
                    return data.matches || [];
                } catch (error) {
                    console.error('Error checking grammar:', error);
                    apiStatusIndicator.classList.remove('status-connected');
                    apiStatusIndicator.classList.add('status-disconnected');
                    apiStatusText.textContent = 'Tidak terhubung dengan API. Menggunakan pemeriksaan dasar.';
                    return [];
                }
            }
            
            // Fungsi pemeriksaan proofreading
            async function checkNovel() {
                const text = novelText.value;
                originalText = text;
                
                if (!text.trim()) {
                    resultsContainer.innerHTML = `
                        <div class="issue-item issue-error">
                            <div class="issue-type"><span>‚ùå</span> Tidak ada teks</div>
                            <div class="issue-context">Silakan masukkan naskah novel untuk diperiksa</div>
                        </div>
                    `;
                    issueCountEl.textContent = '0';
                    return;
                }
                
                // Tampilkan status loading
                checkBtn.innerHTML = '<span class="loading"></span> Memeriksa...';
                checkBtn.disabled = true;
                
                issues = [];
                
                // 1. Gunakan API untuk pemeriksaan tata bahasa
                const apiIssues = await checkGrammarWithAPI(text);
                
                apiIssues.forEach(issue => {
                    issues.push({
                        type: issue.rule.category.name,
                        message: issue.message,
                        context: issue.context.text,
                        offset: issue.offset,
                        length: issue.length,
                        replacements: issue.replacements,
                        isGrammar: true
                    });
                });
                
                // 2. Periksa konsistensi nama karakter (contoh sederhana)
                if (text.includes('Rania') && text.includes('Raniah')) {
                    issues.push({
                        type: 'Konsistensi Nama',
                        message: 'Nama karakter tidak konsisten: "Rania" dan "Raniah"',
                        context: 'Periksa penggunaan nama karakter di seluruh naskah',
                        position: 0,
                        isGrammar: false
                    });
                }
                
                // 3. Periksa format dialog
                const dialogRegex = /"[^"]*"[^.,!?]*[.,!?](?![^"]*")/g;
                let dialogMatch;
                while ((dialogMatch = dialogRegex.exec(text)) !== null) {
                    // Cek apakah dialog diakhiri dengan tanda baca yang benar
                    const dialog = dialogMatch[0];
                    if (!dialog.match(/[.,!?]"$/)) {
                        issues.push({
                            type: 'Format Dialog',
                            message: 'Dialog mungkin tidak diakhiri dengan tanda baca yang tepat',
                            context: dialog.substring(0, 40) + '...',
                            position: dialogMatch.index,
                            isGrammar: false
                        });
                    }
                }
                
                // 4. Periksa kata berulang
                const words = text.toLowerCase().split(/\s+/);
                const wordCount = {};
                words.forEach(word => {
                    // Hilangkan tanda baca
                    const cleanWord = word.replace(/[.,!?;:"']/g, '');
                    if (cleanWord.length > 4) { // Hanya kata dengan 5+ huruf
                        wordCount[cleanWord] = (wordCount[cleanWord] || 0) + 1;
                    }
                });
                
                // Temukan kata yang sering diulang
                for (const [word, count] of Object.entries(wordCount)) {
                    if (count > 5) {
                        issues.push({
                            type: 'Kata Berulang',
                            message: `Kata "${word}" digunakan ${count} kali, pertimbangkan menggunakan sinonim`,
                            context: `Contoh: ...${text.substr(text.indexOf(word), 30)}...`,
                            position: text.indexOf(word),
                            isGrammar: false
                        });
                    }
                }
                
                // Tampilkan hasil
                displayResults(issues);
                
                // Reset button state
                checkBtn.innerHTML = '<span>üîç</span> Periksa Naskah';
                checkBtn.disabled = false;
                fixAllBtn.disabled = issues.filter(issue => issue.isGrammar).length === 0;
            }
            
            // Tampilkan hasil pemeriksaan
            function displayResults(issues) {
                issueCountEl.textContent = issues.length;
                
                if (issues.length === 0) {
                    resultsContainer.innerHTML = `
                        <div class="issue-item issue-success">
                            <div class="issue-type"><span>‚úÖ</span> Tidak ada masalah ditemukan</div>
                            <div class="issue-context">Naskah Anda terlihat baik! Tetap disarankan untuk pemeriksaan manual menyeluruh.</div>
                        </div>
                    `;
                    return;
                }
                
                let resultsHTML = '';
                issues.forEach((issue, index) => {
                    const icon = issue.isGrammar ? 'üî§' : 'üìù';
                    const issueClass = issue.isGrammar ? 'issue-error' : 'issue-info';
                    
                    resultsHTML += `
                        <div class="issue-item ${issueClass}" data-index="${index}">
                            <div class="issue-type">${icon} ${issue.type}</div>
                            <div class="issue-message">${issue.message}</div>
                            ${issue.replacements && issue.replacements.length > 0 ? 
                                `<div class="issue-context">Saran: <span class="suggestion">${issue.replacements[0].value}</span></div>` : ''}
                            <div class="issue-context">...${issue.context}...</div>
                            ${issue.isGrammar ? `<button onclick="applySuggestion(${index})" class="btn-secondary" style="margin-top: 8px; padding: 5px 10px; font-size: 0.8rem;">Terapkan Saran</button>` : ''}
                        </div>
                    `;
                });
                
                resultsContainer.innerHTML = resultsHTML;
                saveBtn.disabled = false;
                exportBtn.disabled = false;
            }
            
            // Terapkan saran perbaikan
            window.applySuggestion = function(index) {
                if (!issues[index] || !issues[index].isGrammar || !issues[index].replacements) return;
                
                const issue = issues[index];
                const replacement = issue.replacements[0].value;
                const text = novelText.value;
                
                // Ganti teks yang salah dengan saran
                const newText = text.substring(0, issue.offset) + 
                               replacement + 
                               text.substring(issue.offset + issue.length);
                
                novelText.value = newText;
                updateBasicStats();
                
                // Hapus issue yang telah diperbaiki dari daftar
                issues.splice(index, 1);
                displayResults(issues);
                issueCountEl.textContent = issues.length;
                fixAllBtn.disabled = issues.filter(issue => issue.isGrammar).length === 0;
            };
            
            // Perbaiki semua masalah tata bahasa
            async function fixAllGrammar() {
                const grammarIssues = issues.filter(issue => issue.isGrammar && issue.replacements);
                if (grammarIssues.length === 0) return;
                
                // Urutkan dari offset terbesar ke terkecil untuk menghindari konflik posisi
                grammarIssues.sort((a, b) => b.offset - a.offset);
                
                let text = novelText.value;
                
                // Terapkan semua perbaikan
                grammarIssues.forEach(issue => {
                    if (issue.replacements && issue.replacements.length > 0) {
                        text = text.substring(0, issue.offset) + 
                              issue.replacements[0].value + 
                              text.substring(issue.offset + issue.length);
                    }
                });
                
                novelText.value = text;
                updateBasicStats();
                
                // Hapus semua masalah tata bahasa yang telah diperbaiki
                issues = issues.filter(issue => !issue.isGrammar);
                displayResults(issues);
                issueCountEl.textContent = issues.length;
                fixAllBtn.disabled = true;
            }
            
            // Event listeners
            checkBtn.addEventListener('click', checkNovel);
            
            clearBtn.addEventListener('click', function() {
                novelText.value = '';
                resultsContainer.innerHTML = `
                    <div class="issue-item">
                        <div class="issue-type"><span>üìù</span> Naskah dibersihkan</div>
                        <div class="issue-context">Silakan masukkan naskah novel untuk diperiksa</div>
                    </div>
                `;
                updateBasicStats();
                issueCountEl.textContent = '0';
                saveBtn.disabled = true;
                exportBtn.disabled = true;
                fixAllBtn.disabled = true;
            });
            
            sampleBtn.addEventListener('click', function() {
                novelText.value = `Kapitel 1: Pertemuan

Dia berjalan pelan disepanjang koridor yang gelap. Angin berbisik pelan, membawa suara-suara yang tak jelas. Rania merasa ada yang mengawasinya, tapi ketika berbalik, tak ada siapapun disana.

"Apakah aku hanya membayangkan?" katanya dalam hati.

Tiba-tiba, pintu disebelahnya terbuka dengan suara berderit. Seorang pria tinggi muncul dengan pakaian serba hitam.

"Kau seharusnya tidak berada disini," katanya dengan suara rendah.

Rania merasa jantungnya berdebar kencang. Dia mencoba berkata sesuatu, tapi kata-katanya tersangkut di tenggorokan.`;
                updateBasicStats();
            });
            
            fixAllBtn.addEventListener('click', fixAllGrammar);
            
            saveBtn.addEventListener('click', function() {
                const resultText = `HASIL PROOFREADING NOVEL
=================================
Tanggal: ${new Date().toLocaleDateString('id-ID')}
Total masalah ditemukan: ${issues.length}

${issues.map(issue => `[${issue.type}] ${issue.message}`).join('\n')}
                `;
                
                const blob = new Blob([resultText], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'hasil-proofreading.txt';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            });
            
            exportBtn.addEventListener('click', function() {
                alert('Fitur ekspor PDF akan diimplementasikan pada versi mendatang.');
            });
        });
    </script>
</body>
</html>
